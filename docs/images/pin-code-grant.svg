<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="932px" preserveAspectRatio="none" style="width:765px;height:932px;" version="1.1" viewBox="0 0 765 932" width="765px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="214" x="277" y="27.4023">Code Authorization Flow</text><rect fill="#DDDDDD" height="882.7852" style="stroke: #A80036; stroke-width: 1.0;" width="286" x="260.5" y="39.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="145" x="329" y="51.7676">Authorization Service</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="354" y="67.0781">(lives in Terra)</text><rect fill="#FFFFFF" height="144.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="174.5" y="180.7969"/><rect fill="#FFFF00" height="55.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="179.5" y="218.1074"/><rect fill="#FFFFFF" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="174.5" y="456.9023"/><rect fill="#FFFFFF" height="143.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="174.5" y="618.7656"/><rect fill="#FFFF00" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="179.5" y="698.3867"/><rect fill="#FFFFFF" height="248.7949" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="324.5" y="325.3496"/><rect fill="#FFFFFF" height="103.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="473.5" y="515.5234"/><rect fill="#FFFFFF" height="35.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="595" y="762.6973"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="66" x2="66" y1="134.1758" y2="823.0078"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="179" x2="179" y1="134.1758" y2="823.0078"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="329.5" x2="329.5" y1="134.1758" y2="823.0078"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="478.5" x2="478.5" y1="134.1758" y2="823.0078"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="599.5" x2="599.5" y1="134.1758" y2="823.0078"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="23.5" y="114.7344">Broker User</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="8" y="131.2227">(Charité Patient)</text><ellipse cx="66.5" cy="48.1992" fill="#FEFECE" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M66.5,56.1992 L66.5,83.1992 M53.5,64.1992 L79.5,64.1992 M66.5,83.1992 L53.5,98.1992 M66.5,83.1992 L79.5,98.1992 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="23.5" y="835.543">Broker User</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="8" y="852.0313">(Charité Patient)</text><ellipse cx="66.5" cy="864.9844" fill="#FEFECE" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M66.5,872.9844 L66.5,899.9844 M53.5,880.9844 L79.5,880.9844 M66.5,899.9844 L53.5,914.9844 M66.5,899.9844 L79.5,914.9844 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="59" x="150" y="102.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="157" y="123.2227">Broker</text><rect fill="#FEFECE" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="59" x="150" y="822.0078"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="157" y="842.543">Broker</text><rect fill="#FEFECE" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="110" x="274.5" y="86.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="96" x="281.5" y="106.7344">Auth Frontent</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="308" y="123.2227">(Luna)</text><rect fill="#FEFECE" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="110" x="274.5" y="822.0078"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="96" x="281.5" y="842.543">Auth Frontent</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="308" y="859.0313">(Luna)</text><rect fill="#FEFECE" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="108" x="424.5" y="86.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="94" x="431.5" y="106.7344">Auth Backend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="456.5" y="123.2227">(Vega)</text><rect fill="#FEFECE" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="108" x="424.5" y="822.0078"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="94" x="431.5" y="842.543">Auth Backend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="456.5" y="859.0313">(Vega)</text><rect fill="#FEFECE" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="75" x="562.5" y="86.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="569.5" y="106.7344">Web App</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="47" x="576.5" y="123.2227">(Terra)</text><rect fill="#FEFECE" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="75" x="562.5" y="822.0078"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="569.5" y="842.543">Web App</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="47" x="576.5" y="859.0313">(Terra)</text><rect fill="#FFFFFF" height="144.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="174.5" y="180.7969"/><rect fill="#FFFF00" height="55.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="179.5" y="218.1074"/><rect fill="#FFFFFF" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="174.5" y="456.9023"/><rect fill="#FFFFFF" height="143.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="174.5" y="618.7656"/><rect fill="#FFFF00" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="179.5" y="698.3867"/><rect fill="#FFFFFF" height="248.7949" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="324.5" y="325.3496"/><rect fill="#FFFFFF" height="103.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="473.5" y="515.5234"/><rect fill="#FFFFFF" height="35.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="595" y="762.6973"/><polygon fill="#A80036" points="162.5,176.7969,172.5,180.7969,162.5,184.7969,166.5,180.7969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="66.5" x2="168.5" y1="180.7969" y2="180.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="73.5" y="168.3994">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="86.5" y="160.7441">Connection</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="86.5" y="176.0547">Request</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="184.5" x2="231.5" y1="205.1074" y2="205.1074"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="231.5" x2="231.5" y1="205.1074" y2="218.1074"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="190.5" x2="231.5" y1="218.1074" y2="218.1074"/><polygon fill="#A80036" points="200.5,214.1074,190.5,218.1074,200.5,222.1074,196.5,218.1074" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="196.5" y="200.3652">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="209.5" y="200.3652">initialize SDK</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="189.5" x2="231.5" y1="272.7285" y2="272.7285"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="231.5" x2="231.5" y1="272.7285" y2="285.7285"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="184.5" x2="231.5" y1="285.7285" y2="285.7285"/><polygon fill="#A80036" points="194.5,281.7285,184.5,285.7285,194.5,289.7285,190.5,285.7285" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="196.5" y="260.3311">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="209.5" y="252.6758">generate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="209.5" y="267.9863">Authorization Url</text><polygon fill="#A80036" points="312.5,321.3496,322.5,325.3496,312.5,329.3496,316.5,325.3496" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="179.5" x2="318.5" y1="325.3496" y2="325.3496"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="186.5" y="312.9521">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93" x="199.5" y="305.2969">Authentication</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="199.5" y="320.6074">Request</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="334.5" x2="376.5" y1="354.6602" y2="354.6602"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="376.5" x2="376.5" y1="354.6602" y2="367.6602"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="335.5" x2="376.5" y1="367.6602" y2="367.6602"/><polygon fill="#A80036" points="345.5,363.6602,335.5,367.6602,345.5,371.6602,341.5,367.6602" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="341.5" y="349.918">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="74" x="354.5" y="349.918">render page</text><polygon fill="#A80036" points="312.5,423.5918,322.5,427.5918,312.5,431.5918,316.5,427.5918" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="66.5" x2="318.5" y1="427.5918" y2="427.5918"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="73.5" y="407.5391">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="86.5" y="392.2285">Enters credentials:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="86.5" y="407.5391">email, password,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="86.5" y="422.8496">pin</text><polygon fill="#A80036" points="195.5,452.9023,185.5,456.9023,195.5,460.9023,191.5,456.9023" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189.5" x2="323.5" y1="456.9023" y2="456.9023"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="201.5" y="452.1602">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59" x="214.5" y="452.1602">verify pin</text><polygon fill="#A80036" points="312.5,482.2129,322.5,486.2129,312.5,490.2129,316.5,486.2129" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="179.5" x2="318.5" y1="486.2129" y2="486.2129"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="186.5" y="481.4707">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="199.5" y="481.4707">verify response</text><polygon fill="#A80036" points="461.5,511.5234,471.5,515.5234,461.5,519.5234,465.5,515.5234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="334.5" x2="467.5" y1="515.5234" y2="515.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="341.5" y="510.7813">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="354.5" y="510.7813">login/register</text><polygon fill="#A80036" points="345.5,540.834,335.5,544.834,345.5,548.834,341.5,544.834" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="339.5" x2="472.5" y1="544.834" y2="544.834"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="351.5" y="540.0918">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93" x="373.5" y="540.0918">login response</text><polygon fill="#A80036" points="461.5,570.1445,471.5,574.1445,461.5,578.1445,465.5,574.1445" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="329.5" x2="467.5" y1="574.1445" y2="574.1445"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="336.5" y="569.4023">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="358.5" y="569.4023">approve</text><polygon fill="#A80036" points="195.5,614.7656,185.5,618.7656,195.5,622.7656,191.5,618.7656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189.5" x2="477.5" y1="618.7656" y2="618.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="201.5" y="606.3682">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93" x="223.5" y="598.7129">Authentication</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="223.5" y="614.0234">Response</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="184.5" x2="226.5" y1="648.0762" y2="648.0762"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="226.5" x2="226.5" y1="648.0762" y2="661.0762"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="185.5" x2="226.5" y1="661.0762" y2="661.0762"/><polygon fill="#A80036" points="195.5,657.0762,185.5,661.0762,195.5,665.0762,191.5,661.0762" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="191.5" y="643.334">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="213.5" y="643.334">restore state</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="189.5" x2="231.5" y1="690.3867" y2="690.3867"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="231.5" x2="231.5" y1="690.3867" y2="703.3867"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="190.5" x2="231.5" y1="703.3867" y2="703.3867"/><polygon fill="#A80036" points="200.5,699.3867,190.5,703.3867,200.5,707.3867,196.5,703.3867" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="196.5" y="685.6445">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="218.5" y="685.6445">initialize SDK</text><polygon fill="#A80036" points="583,758.6973,593,762.6973,583,766.6973,587,762.6973" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="179.5" x2="589" y1="762.6973" y2="762.6973"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="186.5" y="757.9551">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="208.5" y="757.9551">redirect</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="605" x2="647" y1="797.0078" y2="797.0078"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="647" x2="647" y1="797.0078" y2="810.0078"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="600" x2="647" y1="810.0078" y2="810.0078"/><polygon fill="#A80036" points="610,806.0078,600,810.0078,610,814.0078,606,810.0078" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="612" y="792.2656">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="634" y="792.2656">trigger notification</text><!--MD5=[32da0fa7450b4aeaed25a92f2d65cefc]
@startuml
skinparam Shadowing false
skinparam sequenceArrowThickness 1
skinparam maxmessagesize 120
skinparam ParticipantPadding 10
autonumber

actor "Broker User\n(Charité Patient)" as User
participant Broker

box "Authorization Service \n(lives in Terra)"
participant "Auth Frontent\n(Luna)" as Frontend
participant "Auth Backend\n(Vega)" as Backend
end box

participant "Web App\n(Terra)" as WebApp

title Code Authorization Flow

User -> Broker: Connection Request
activate Broker
Broker -> Broker: initialize SDK
activate Broker #Yellow
Broker -> Broker: generate Authorization Url
deactivate Broker
Broker -> Frontend: Authentication Request
deactivate Broker
activate Frontend
Frontend -> Frontend: render page
User -> Frontend: Enters credentials: email, password, pin

Frontend -> Broker: verify pin
activate Broker
Broker -> Frontend: verify response
deactivate Broker

Frontend -> Backend: login/register
activate Backend
Backend -> Frontend: login response
Frontend -> Backend: approve
deactivate Frontend
Backend -> Broker: Authentication Response
deactivate Backend
activate Broker
Broker -> Broker: restore state
Broker -> Broker: initialize SDK
activate Broker #Yellow
deactivate Broker
Broker -> WebApp: redirect
deactivate Broker
activate WebApp
WebApp -> WebApp: trigger notification

deactivate WebApp

@enduml

PlantUML version 1.2020.06(Sun Apr 05 14:38:32 CEST 2020)
(APACHE source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_242-release-1644-b3-6222593
Operating System: Mac OS X
Default Encoding: UTF-8
Language: en
Country: DE
--></g></svg>